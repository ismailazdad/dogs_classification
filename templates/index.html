<!DOCTYPE html>
<html lang="en">
<head>
    <link href="{{ url_for('static',filename='styles/style.css') }}" rel="stylesheet">
    <link href="{{ url_for('static',filename='styles/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static',filename='styles/bootstrap-theme.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static',filename='styles/fileinput.css') }}" rel="stylesheet">
    <link href="{{ url_for('static',filename='styles/icomoon.css') }}" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
</head>
{% include "header.html" %}
<body>
<div class="container">
    <div class="row">
        <div>upload image dogs to prdict breeds</div>
        <div class="col-lg-12 col-sm-12 col-11 main-section">
            <h1 class="text-center text-primary"> race predictions </h1>

            <form id="data" method="post" enctype="multipart/form-data">
                <div class="row">
                    <input type='file' id="file" name="file"/>
                    <div id='img_contain' style="text-align: center;">
                        <img id="image-preview" align='middle'
                             src="http://www.clker.com/cliparts/c/W/h/n/P/W/generic-image-file-icon-hi.png"
                             alt="your image"
                             title=''/>
                    </div>
                </div>
                <div class="row">
                    <button class="btn btn-primary">Submit</button>
                </div>
            </form>


            <div id="wait" style="display: none;">
                <img src="{{ url_for('static',filename='img/loading.gif') }}">
            </div>
            <div>
                <div id="resultdiv"></div>
                <div class="container" style="margin-top: 2%; height: 300px;">
                    <div class="row">
                        <div id="results" class="col-md-2 col-md-offset-5"></div>
                    </div>
                </div>
            </div>


        </div>
    </div>
</div>
</div>
{% include "footer.html" %}
<script src="{{ url_for('static',filename='javascript/jquery-3.2.1.min.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static',filename='javascript/bootstrap.min.js') }}" type="text/javascript"></script>
<script src="{{ url_for('static',filename='javascript/fileinput.js') }}" type="text/javascript"></script>
<script>
    $("form#data").submit(function (e) {
        e.preventDefault();
        $('#results').empty();
        var formData = new FormData(this);
        $('#wait').show();
        $.ajax({
            url: "/tagGenerators",
            type: 'POST',
            data: formData,
            success: function (data) {
                $('#wait').hide();
                console.log(data);
                for (const [key, value] of Object.entries(data)) {
                    console.log(`${key}: ${value}`);
                    $('#results').append("<div style='margin-top: 2%'><button type='button' class='btn btn-warning'><label>" + key + " </label></button>  confidence : " + Math.round(value) + "% <progress max='100' value='" + value + "'> </progress></div> ");
                }
            },
            cache: false,
            contentType: false,
            processData: false
        });
    });


    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#image-preview').attr('src', e.target.result);
                $('#image-preview').attr('align', 'middle');
                $('#image-preview').hide();
                $('#image-preview').fadeIn(650);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#file").change(function () {
        readURL(this);
    });

</script>

</body>
</html>